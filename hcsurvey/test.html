<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>「睡商」大挑战</title>
    <link rel="stylesheet" href="./main.css">

    <script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>

    <!--
    <script src="http://assets.dxycdn.com/app/event/20150311/dist/js/main.min.js?t=2015050701"></script>
    -->

    <!--
    <script src="http://assets.dxycdn.com/docs/plugin/dxy_get_install/getInstall.js"></script>
    -->
</head>
<body>
    <div class="container pos-start">
        <!-- 起始页 -->
        <div class="start blk">
            <!--
            <h1><img src="http://assets.dxycdn.com/app/event/20150311/img/heading.png?t=2015031208" alt="“睡商”大挑战"></h1>
            <img src="http://assets.dxycdn.com/app/event/20150311/img/topic.png?t=2015031203" alt="一个在睡觉的人" class="topic">
            -->
            <h1>
                疾病自查
            </h1>
            <br/>
            <h1 style="font-size: 4em;color: red;">
                心悸
            </h1>
            <br/>
            <p style="font-size: 2em;color: yellow">
                心悸是自觉心跳快而强，并伴有心前区不适感。可有心脏跳动异常快速、强烈或者不规则等现象。与心慌的感觉类似。
            </p>
            <a href="javascript:;" class="start-btn btn">开始测试</a>
            <p class="source">
                内容来源：无<br>搜狐健康出品 health.sohu.com
            </p>
        </div>

        <!-- 过程页 -->
        <div class="process blk">
            <div class="quiz-blk">
                <div class="center-box quiz-top-box">
                    <p class="quiz-top">第 <span class="quiz-num"></span> 题&nbsp;&nbsp;(<span class="quiz-num"></span>/<span class="quiz-total"></span>)</p>
                </div>
                <div class="center-box quiz-desc-box">
                    <p class="quiz-desc"></p>
                </div>
            </div>
            <div class="opt-blk sub-blk">
                <a href="javascript:;" class="right-btn opt-btn">是</a>
                <a href="javascript:;" class="wrong-btn opt-btn">不是</a>
            </div>
            <div class="answer-blk sub-blk">
                <p class="right-sign sign show">回答正确</p>
                <p class="wrong-sign sign">回答错误</p>
                <p class="quiz-text">
                </p>
                <a href="javascript:;" class="btn next-btn">下一题</a>
            </div>
        </div>

        <!-- 结果页 -->
        <div class="result blk">
            <div class="result-blk">
                <p class="result-heading">
                </p>
                <p class="result-text">
                </p>
            </div>
            <div class="prom-box">
                <p class="prom-heading">为了让你更加幸福</p>
                <p class="prom-text">
                    医加为您准备几篇文章
                </p>
                <a href="http://health.sohu.com" schema="http://health.sohu.com" data-link="dxy-aspirin://news/2504" class="btn view-btn">前往查看</a>
                <img src="./logo.png" alt="医加健康" class="logo">
            </div>
        </div>
    </div>
    <script src="./zepto.min.js"></script>
    <script>

        var quiz = {
            'cur': 0,
            'body': [
            {'symptom': '处于忧郁、发恕、沮丧等不良情绪之下',
                'ill': '精神因素引起的食欲减退',},
            {'symptom': '发热和感染引起的各种局部炎症症状',
                'ill': '感染性疾病',},
            {'symptom': '黄疸、肝掌、蜘蛛痣',
                'ill': '肝硬化',},
            {'symptom': '恶心、呕吐、腹痛',
                'ill': '胃肠道炎症，胆道或胰腺病',},
            {'symptom': '吸烟过度服用某些药物或接触毒物',
                'ill': '中毒反应',},
            ],
        }
        var cur = 0;

        $('.start-btn').on('click', function() {
            initQuiz();
            pushQuestion(cur);
        });
        $('.opt-btn').on('click', function() {
            $('.process').addClass('answered');
            // TODO: judge
            if ($(this).hasClass('right-btn')) {
                judgeQuestion(cur, 0);
            } else {
                judgeQuestion(cur, 1);
            }
        });
        $('.next-btn').on('click', function() {
            if (cur < quiz.body.length) {
                pushQuestion(cur + 1);
                cur = cur + 1;
            } else {
                showResult();
            }
        });

        function initQuiz() {
            $('.quiz-total').html('6');

        }

        function judgeQuestion(index, answer) {
            // TODO: judge
            if (cur < quiz.body.length - 1) {
                if ( answer === 0) {
                    showResult(); 
                } else {
                    pushQuestion(cur + 1);
                    cur = cur + 1;
                }
            } else {
                showDefaultResult();
            }

        }

        function pushQuestion(index) {
            $('.container').addClass('pos-process');
            $('.container').removeClass('pos-start');
            $('.process').removeClass('answered');

            $('.quiz-num').html(index + 1);
            $('.quiz-desc').html('你是否' + quiz['body'][cur]['symptom'] + '?');

            if (index >= quiz.body.length) {
                $('.next-btn').html('查看结果');
            }
        }
        function showResult() {
            $('.container').removeClass('pos-process');
            $('.container').removeClass('pos-start');
            $('.container').addClass('pos-result');
            $('.process').removeClass('answered');

            $('.result-heading').html('你可能得了&nbsp;&nbsp <span style="font-size: 2.5em; color: red;">' + quiz['body'][cur]['ill'] + '</span>');
            // 下面是详细内容
            $('.result-text').html('');
        }
        function showDefaultResult() {
            $('.container').removeClass('pos-process');
            $('.container').removeClass('pos-start');
            $('.container').addClass('pos-result');
            $('.process').removeClass('answered');

            $('.result-heading').html('<span style="font-size: 1.6em; color: red;">请尽快到医院进行全面检查！</span>');
            // 下面是详细内容
            $('.result-text').html('');
        }

    </script>
</body>
</html>
